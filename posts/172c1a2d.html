<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>ElasticSearch学习笔记 | 拾忆鱼's Blog</title><meta name="author" content="拾忆鱼"><meta name="copyright" content="拾忆鱼"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="referrer" content="no-referrer" /><meta name="description" content="1.ElasticSearch是什么  1.1ElasticSearch简介   Elasticsearch 是一个分布式、RESTful 风格的搜索和数据分析引擎   ElasticSearch特点：  分布式的文件存储，每个字段都被索引且可用于搜索。 分布式的实时分析搜索引擎，海量数据下近实时秒级响应。 简单的restful api，天生的兼容多语言开发。 易扩展，处理PB级结构化或非结构化">
<meta property="og:type" content="article">
<meta property="og:title" content="ElasticSearch学习笔记">
<meta property="og:url" content="https://www.haipeng-lin.cn/posts/172c1a2d.html">
<meta property="og:site_name" content="拾忆鱼&#39;s Blog">
<meta property="og:description" content="1.ElasticSearch是什么  1.1ElasticSearch简介   Elasticsearch 是一个分布式、RESTful 风格的搜索和数据分析引擎   ElasticSearch特点：  分布式的文件存储，每个字段都被索引且可用于搜索。 分布式的实时分析搜索引擎，海量数据下近实时秒级响应。 简单的restful api，天生的兼容多语言开发。 易扩展，处理PB级结构化或非结构化">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://haipeng-lin.oss-cn-shenzhen.aliyuncs.com/202410161138400.png">
<meta property="article:published_time" content="2024-10-16T03:36:17.000Z">
<meta property="article:modified_time" content="2024-10-16T03:39:14.951Z">
<meta property="article:author" content="拾忆鱼">
<meta property="article:tag" content="SpringBoot">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://haipeng-lin.oss-cn-shenzhen.aliyuncs.com/202410161138400.png"><link rel="shortcut icon" href="https://haipeng-lin.oss-cn-shenzhen.aliyuncs.com/202410101530409.png"><link rel="canonical" href="https://www.haipeng-lin.cn/posts/172c1a2d"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="msvalidate.01" content="7A691DA1ABC779E7F680EF66E1D934AA"/><meta name="google-site-verification"/><meta name="baidu-site-verification" content="XXXXX"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":250},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 拾忆鱼","link":"链接: ","source":"来源: 拾忆鱼's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ElasticSearch学习笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-10-16 11:39:14'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/gitcalendar/css/gitcalendar.css"/><link rel="stylesheet" href="/css/tag_plugins.css"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/swiper.min.css"><script src="https://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script><link rel="stylesheet" href="/css/tags.css"><link rel="stylesheet" href="/css/double_article.css"><link rel="stylesheet" href="/css/nav.css"><link rel="stylesheet" href="/css/essay_page.css"><script type="text/javascript" src="/js/echarts.min.js"></script><script type="text/javascript" src="/js/copy.js"></script><script src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><link rel="stylesheet" href="/css/copyright.css"><link rel="stylesheet" href="/css/progress_bar.css"><link rel="stylesheet" href="/css/footer.css"><link rel="stylesheet" href="/css/page.css"><link rel="stylesheet" href="/css/layout.css"><link rel="stylesheet" href="/css/color.css"><link rel="stylesheet" href="/css/cursors/cursors.css"><link rel="stylesheet" href="/css/fonts/font.css"><link rel="stylesheet" href="/css/about/about.css"><link rel="stylesheet" href="/css/about/careers.css"><link rel="stylesheet" href="/css/about/genshinimpact.css"><link rel="stylesheet" href="/css/about/hello-about.css"><link rel="stylesheet" href="/css/about/site.css"><link rel="stylesheet" href="/css/about/skills.css"><link rel="stylesheet" href="/css/photo.css"><link rel="stylesheet" href="/css/icat.css"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="拾忆鱼's Blog" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://haipeng-lin.oss-cn-shenzhen.aliyuncs.com/202410101530409.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">59</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives"><i class="fa-fw fas fa-archive"></i><span> 全部</span></a></li><li><a class="site-page child" href="/categories"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heart"></i><span> 空间</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/essay"><i class="fa-fw fas fa-comments"></i><span> 碎碎念</span></a></li><li><a class="site-page child" href="/collect"><i class="fa-fw fas fa-walking"></i><span> 足迹阁</span></a></li><li><a class="site-page child" href="/photo"><i class="fa-fw fas fa-images"></i><span> 照片墙</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fas fa-address-card"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">拾忆鱼's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives"><i class="fa-fw fas fa-archive"></i><span> 全部</span></a></li><li><a class="site-page child" href="/categories"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heart"></i><span> 空间</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/essay"><i class="fa-fw fas fa-comments"></i><span> 碎碎念</span></a></li><li><a class="site-page child" href="/collect"><i class="fa-fw fas fa-walking"></i><span> 足迹阁</span></a></li><li><a class="site-page child" href="/photo"><i class="fa-fw fas fa-images"></i><span> 照片墙</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fas fa-address-card"></i><span> 关于</span></a></div></div><center id="name-container"><a id="page-name" href="javascript:btf.scrollToDest(0, 500)">PAGE_NAME</a></center></div><div id="toggleButtons"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">ElasticSearch学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-10-16T03:36:17.000Z" title="发表于 2024-10-16 11:36:17">2024-10-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-10-16T03:39:14.951Z" title="更新于 2024-10-16 11:39:14">2024-10-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E3%80%90%E6%8A%80%E6%9C%AF%E6%A0%88%E5%AD%A6%E4%B9%A0%E3%80%91/">【技术栈学习】</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ElasticSearch学习笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h1 id="1elasticsearch是什么"><a class="markdownIt-Anchor" href="#1elasticsearch是什么"></a> 1.ElasticSearch是什么</h1>
<h2 id="11elasticsearch简介"><a class="markdownIt-Anchor" href="#11elasticsearch简介"></a> 1.1ElasticSearch简介</h2>
<p>  Elasticsearch 是一个分布式、RESTful 风格的搜索和数据分析引擎</p>
<ol>
<li>
<p><strong>ElasticSearch特点：</strong></p>
<ol>
<li>分布式的文件存储，<strong>每个字段都被索引</strong>且可用于搜索。</li>
<li><strong>分布式</strong>的实时分析搜索引擎，<strong>海量数据</strong>下近实时秒级响应。</li>
<li>简单的<strong>restful api</strong>，天生的兼容多语言开发。</li>
<li><strong>易扩展</strong>，处理PB级结构化或非结构化数据</li>
</ol>
</li>
<li>
<p><strong>ElasticSearch缺点：</strong></p>
<ol>
<li>由于 Elasticsearch 需要处理大量的数据，因此需要<strong>较高的硬件性能</strong>和存储空间。</li>
<li>由于 Elasticsearch 是一个分布式系统，可能存在<strong>数据一致性</strong>问题</li>
</ol>
</li>
<li>
<p><strong>适用场景：</strong></p>
<ol>
<li>日志分析：Elasticsearch 可以快速地搜索和分析大量的日志数据。</li>
<li>搜索引擎：Elasticsearch 可以作为搜索引擎用于搜索和排序数据。</li>
<li>数据分析：Elasticsearch 可以用于数据分析，支持聚合和分析数据。</li>
<li>地理位置搜索：Elasticsearch 支持地理位置搜索，可以用于地图应用等。</li>
</ol>
</li>
</ol>
<h2 id="12es与solr对比"><a class="markdownIt-Anchor" href="#12es与solr对比"></a> 1.2ES与Solr对比</h2>
<ol>
<li>Solr是Apache Lucene项目的开源<strong>企业搜索平台</strong>。其主要功能包括<strong>全文检索</strong>、命中标示、分面搜索、动态聚类、数据库集成，以及富文本（如Word、PDF）的处理；Solr是高度可扩展的，并提供了分布式搜索和索引复制功能</li>
<li>当单纯的对<strong>已有数据</strong>进行搜索时，Solr更快；当实时建立索引时，Solr会产生io阻塞，查询性能较差</li>
<li>随着<strong>数据量的增加</strong>，Solr的搜索效率会变得更<strong>低</strong>，而Elasticsearch却没有明显的变化。</li>
</ol>
<h2 id="13es与mysql对比"><a class="markdownIt-Anchor" href="#13es与mysql对比"></a> 1.3ES与MySQL对比</h2>
<ol>
<li>结论：ElasticSearch比MySQL查询快，原因如下：</li>
<li><strong>基于分词后的全文检索：</strong>
<ol>
<li>例如select * from test where name like ‘%张三%’，对于mysql来说，因为索引失效，会进行全表检索；</li>
<li>对es而言分词后，每个字都可以利用FST高速找到倒排索引的位置，并迅速获取文档id列表，大大的提升了性能，减少了磁盘IO</li>
</ol>
</li>
<li><strong>精确检索：</strong>
<ol>
<li>进行精确检索，有些时候可能mysql要快一些，当mysql的非聚合索引引用上了聚合索引，无需回表，则速度上可能更快；</li>
<li>es还是通过FST找到倒排索引的位置比获取文档id列表，再根据文档id获取文档并根据相关度进行排序</li>
<li>但是es还有个优势，就是es即天然的分布式能够在大量数据搜索时可以通过分片降低检索规模，并且可以通过并行检索提升效率，用filter时，更是可以直接跳过检索直接走缓存</li>
</ol>
</li>
</ol>
<h2 id="14es基本概念"><a class="markdownIt-Anchor" href="#14es基本概念"></a> 1.4ES基本概念</h2>
<p><img src="https://haipeng-lin.oss-cn-shenzhen.aliyuncs.com/202410161110837.jpeg" alt="img" /></p>
<h3 id="141index-索引"><a class="markdownIt-Anchor" href="#141index-索引"></a> 1.4.1Index-索引</h3>
<p>Index，即索引，关键词有两种用法，可用作动词、或者名词</p>
<ol>
<li>动词,相当于MySQL中的insert、插入</li>
<li>名词,相当于MySQL中的Database、数据库</li>
</ol>
<h3 id="142type-类型"><a class="markdownIt-Anchor" href="#142type-类型"></a> 1.4.2Type-类型</h3>
<ol>
<li>在Index（索引）中,可以定义一个或多个类型,每种类型的数据放一起；类似于MySQL中数据库中可以定义一个或多个表（Table）;</li>
<li>ES7、8版本差异：
<ol>
<li>Elasticsearch 7. X URL中<strong>的type参数为可选</strong>。比如，索引一个文档不再要求提供文档类型。</li>
<li>Elasticsearch 8.X 不再支持URL中的type参数。ElasticSearch8开始，将索引从多类型迁移到单类型，每种类型文档一个独立索引</li>
<li><strong>原因：<strong>Elasticsearch是基于Lucene开发的搜索引擎，而</strong><mark>ES中不同type下名称相同的filed最终在Lucene中的处理方式是一样的</mark></strong>。不同type中的相同字段名称就会在处理中出现冲突的情况，<strong>导致Lucene处理效率下降</strong>，去掉type就是为了提高ES处理数据的效率。</li>
</ol>
</li>
</ol>
<h3 id="143document-文档"><a class="markdownIt-Anchor" href="#143document-文档"></a> 1.4.3Document-文档</h3>
<ol>
<li>保存到某个索引(Index)下,某种类型(Type)的一个数据(Document)，文档是JSON格式的</li>
<li>一个Document就像是MySQL中某个表的一条记录.</li>
</ol>
<h3 id="144倒排索引"><a class="markdownIt-Anchor" href="#144倒排索引"></a> 1.4.4倒排索引</h3>
<p>由于不是由记录来确定属性值，而是由属性值来确定记录的位置，因而称为倒排索引(inverted index)</p>
<ul>
<li>索引存储示例</li>
</ul>
<p>将整句拆分为单词,将单词的值与索引存储起来,就可以根据单词查询索引位置,然后根据检索条件的相关性得分进行排序</p>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231125161941142.png" alt="image-20231125161941142" /></p>
<h1 id="2安装elasticsearch"><a class="markdownIt-Anchor" href="#2安装elasticsearch"></a> 2.安装ElasticSearch</h1>
<h2 id="21基于docker安装es与kibana"><a class="markdownIt-Anchor" href="#21基于docker安装es与kibana"></a> 2.1基于Docker安装ES与Kibana</h2>
<h3 id="211下载镜像文件"><a class="markdownIt-Anchor" href="#211下载镜像文件"></a> 2.1.1下载镜像文件</h3>
<p>elasticsearch与kibana版本是同步的</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">docker</span> <span class="string">pull</span> <span class="string">elasticsearch:7.4.2</span> <span class="comment">#存储和检索数据</span></span><br><span class="line"><span class="string">docker</span> <span class="string">pull</span> <span class="string">kibana:7.4.2</span> <span class="comment">#可视化检索数据</span></span><br></pre></td></tr></table></figure>
<h3 id="212创建实例"><a class="markdownIt-Anchor" href="#212创建实例"></a> 2.1.2创建实例</h3>
<h4 id="1创建elasticsearch实例"><a class="markdownIt-Anchor" href="#1创建elasticsearch实例"></a> （1）创建ElasticSearch实例</h4>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#先将es的数据与配置与需要映射的文件夹创建好</span></span><br><span class="line"><span class="string">mkdir</span> <span class="string">-p</span> <span class="string">/mydata/elasticsearch/config</span></span><br><span class="line"><span class="string">mkdir</span> <span class="string">-p</span> <span class="string">/mydata/elasticsearch/data</span></span><br><span class="line"><span class="comment">#配置es地址</span></span><br><span class="line"><span class="string">echo</span> <span class="string">&quot;http.host: 0.0.0.0&quot;</span> <span class="string">&gt;&gt;</span> <span class="string">/mydata/elasticsearch/config/elasticsearch.yml</span></span><br><span class="line"><span class="comment">#保证权限</span></span><br><span class="line"><span class="string">chmod</span> <span class="string">-R</span> <span class="number">777</span> <span class="string">/mydata/elasticsearch/</span> </span><br><span class="line"><span class="comment">#创建并启动实例</span></span><br><span class="line"><span class="string">docker</span> <span class="string">run</span> <span class="string">--name</span> <span class="string">elasticsearch</span> <span class="string">-p</span> <span class="number">9200</span><span class="string">:9200</span> <span class="string">-p</span> <span class="number">9300</span><span class="string">:9300</span> <span class="string">\</span></span><br><span class="line"><span class="string">-e</span> <span class="string">&quot;discovery.type=single-node&quot;</span> <span class="string">\-e</span> <span class="string">ES_JAVA_OPTS=&quot;-Xms64m</span> <span class="string">-Xmx512m&quot;</span> <span class="string">\</span></span><br><span class="line"><span class="string">-v</span> <span class="string">/mydata/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml</span> <span class="string">\</span></span><br><span class="line"><span class="string">-v</span> <span class="string">/mydata/elasticsearch/data:/usr/share/elasticsearch/data</span> <span class="string">\</span></span><br><span class="line"><span class="string">-v</span> <span class="string">/mydata/elasticsearch/plugins:/usr/share/elasticsearch/plugins</span> <span class="string">\</span></span><br><span class="line"><span class="string">-d</span> <span class="string">elasticsearch:7.4.2</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>注意：-e ES_JAVA_OPTS=&quot;-Xms64m -Xmx256m&quot; \ 测试环境下， 设置 ES 的初始内存和最大内存， 否则会导致占用内存过多</p>
</li>
<li>
<p>效果：</p>
</li>
</ul>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231125163451134.png" alt="image-20231125163451134" /></p>
<ul>
<li>
<p>ES的9200和9300端口区别</p>
<ul>
<li>
<p>9200作为Http协议，主要用于外部通讯</p>
</li>
<li>
<p>9300作为Tcp协议，jar之间就是通过tcp协议通讯 .ES集群之间是通过9300进行通讯</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>测试是否创建成功</p>
<p>192.168.234.128:9200 虚拟机地址+9200</p>
<p>记得防火墙开放9200端口</p>
</blockquote>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231125163328991.png" alt="image-20231125163328991" /></p>
<h4 id="2创建kibana实例"><a class="markdownIt-Anchor" href="#2创建kibana实例"></a> （2）创建Kibana实例</h4>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">docker</span> <span class="string">run</span> <span class="string">--name</span> <span class="string">kibana</span> <span class="string">-e</span> <span class="string">ELASTICSEARCH_HOSTS=http://192.168.234.128:9200</span> <span class="string">-p</span> <span class="number">5601</span><span class="string">:5601</span> <span class="string">\</span></span><br><span class="line"><span class="string">-d</span> <span class="string">kibana:7.4.2</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>测试是否创建成功</p>
<p>192.168.234.128:5601</p>
</blockquote>
<img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231125164601714.png" alt="image-20231125164601714" style="zoom: 33%;" />
<h3 id="213设置es和kibana自启动"><a class="markdownIt-Anchor" href="#213设置es和kibana自启动"></a> 2.1.3设置es和kibana自启动</h3>
<blockquote>
<p>先不设置，担心内存不够</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置es在docker开启的时候启动</span></span><br><span class="line"><span class="string">docker</span> <span class="string">update</span> <span class="string">elasticsearch</span> <span class="string">--restart=always</span></span><br><span class="line"><span class="comment"># 设置Kibana在docker开启的时候启动</span></span><br><span class="line"><span class="string">docker</span> <span class="string">update</span> <span class="string">kibana</span> <span class="string">--restart=always</span></span><br></pre></td></tr></table></figure>
<h2 id="22基于windows安装es与kibana"><a class="markdownIt-Anchor" href="#22基于windows安装es与kibana"></a> 2.2基于Windows安装ES与Kibana</h2>
<blockquote>
<p>待写</p>
</blockquote>
<h1 id="3初级检索"><a class="markdownIt-Anchor" href="#3初级检索"></a> 3.初级检索</h1>
<h2 id="31查看节点索引"><a class="markdownIt-Anchor" href="#31查看节点索引"></a> 3.1查看节点/索引</h2>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看所有节点</span></span><br><span class="line"><span class="string">GET</span> <span class="string">/_cat/nodes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看所有节点</span></span><br><span class="line"><span class="string">GET</span> <span class="string">/_cat/health</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看主节点</span></span><br><span class="line"><span class="string">GET</span> <span class="string">/_cat/master</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看所有索引——show databases;</span></span><br><span class="line"><span class="string">GET</span> <span class="string">/_cat/indices</span></span><br></pre></td></tr></table></figure>
<h2 id="32索引保存文档"><a class="markdownIt-Anchor" href="#32索引保存文档"></a> 3.2索引（保存）文档</h2>
<h3 id="321put方法"><a class="markdownIt-Anchor" href="#321put方法"></a> 3.2.1PUT方法</h3>
<p><strong>保存一个数据， 保存在哪个索引的哪个类型下， 指定用哪个唯一标识</strong></p>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231125170734843.png" alt="image-20231125170734843" /></p>
<h3 id="322post方法"><a class="markdownIt-Anchor" href="#322post方法"></a> 3.2.2POST方法</h3>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231125171504137.png" alt="image-20231125171504137" /></p>
<h3 id="323put和post的区别"><a class="markdownIt-Anchor" href="#323put和post的区别"></a> 3.2.3PUT和POST的区别</h3>
<ul>
<li>
<p>相同</p>
<ul>
<li>
<p>PUT与POST都可以新增与修改文档</p>
</li>
<li>
<p>PUT与POST修改文档都是指定id再索引一次</p>
</li>
</ul>
</li>
<li>
<p>不同—<strong>新增上</strong></p>
<ul>
<li><strong>PUT新增只能自定义id</strong>，不能自动生成（PUT本就是设定用来修改的）</li>
<li><strong>POST新增可以不带id（自动生成），也可以自定义id</strong></li>
</ul>
</li>
<li>
<p>补充</p>
<ul>
<li>PUT修改必须指定文档id、否则报错</li>
<li>POST修改若指定存在的文档id，则为修改；若指定不存在或者没有接上文档id，则为新增</li>
</ul>
</li>
</ul>
<h2 id="33查询指定id文档"><a class="markdownIt-Anchor" href="#33查询指定id文档"></a> 3.3查询指定id文档</h2>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231125172846736.png" alt="image-20231125172846736" /></p>
<h2 id="34更新文档"><a class="markdownIt-Anchor" href="#34更新文档"></a> 3.4更新文档</h2>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 之前就是这种写法：版本直接加</span></span><br><span class="line"><span class="string">POST</span> <span class="string">customer/external/1</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;John Doe2&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 会对比之前的内容，相同则版本不变</span></span><br><span class="line"><span class="string">POST</span> <span class="string">customer/external/1/_update</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;doc&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;John Doe2&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新同时增加属性</span></span><br><span class="line"><span class="string">PUT</span> <span class="string">customer/external/1</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;John Doe3&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新同时增加属性</span></span><br><span class="line"><span class="string">POST</span> <span class="string">customer/external/1/_update</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;doc&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;Jane Doe&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;age&quot;:</span> <span class="number">20</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>POST方式一与方式二的区别是否带update</p>
<ul>
<li>
<p><strong>带_update的POST更新：会对比源文档数据</strong>， 如果相同不会有什么操作， 文档 version 不增加</p>
</li>
<li>
<p>不带_update的POST：总会将数据重新保存并增加 version 版本</p>
</li>
<li>
<p>PUT 操作总会将数据重新保存并增加 version 版本；</p>
</li>
</ul>
<h2 id="35删除索引"><a class="markdownIt-Anchor" href="#35删除索引"></a> 3.5删除索引</h2>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除文档</span></span><br><span class="line"><span class="string">DELETE</span> <span class="string">customer/external/1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除索引</span></span><br><span class="line"><span class="string">DELETE</span> <span class="string">customer</span></span><br></pre></td></tr></table></figure>
<h2 id="36bulk批量api"><a class="markdownIt-Anchor" href="#36bulk批量api"></a> 3.6bulk批量API</h2>
<p>在单个 API 调用中执行<mark>多个索引或删除操作</mark>。这减少了开销并且可以大大提高索引速度。</p>
<h3 id="361语法格式"><a class="markdownIt-Anchor" href="#361语法格式"></a> 3.6.1语法格式</h3>
<blockquote>
<p>{ action: { metadata }} //action: 操作; metadata:对哪一个数据进行操作</p>
<p>{ request body } //操作的内容</p>
<p>{ action: { metadata }}</p>
<p>{ request body }</p>
<p>两个一组</p>
</blockquote>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231125223007146.png" alt="image-20231125223007146" /></p>
<h3 id="362复杂bulk"><a class="markdownIt-Anchor" href="#362复杂bulk"></a> 3.6.2复杂bulk</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST /_bulk</span><br><span class="line">&#123; <span class="string">&quot;delete&quot;</span>: &#123; <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;website&quot;</span>, <span class="string">&quot;_type&quot;</span>: <span class="string">&quot;blog&quot;</span>, <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;123&quot;</span> &#125;&#125;</span><br><span class="line">&#123; <span class="string">&quot;create&quot;</span>: &#123; <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;website&quot;</span>, <span class="string">&quot;_type&quot;</span>: <span class="string">&quot;blog&quot;</span>, <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;123&quot;</span> &#125;&#125;</span><br><span class="line">&#123; <span class="string">&quot;title&quot;</span>: <span class="string">&quot;My first blog post&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;index&quot;</span>: &#123; <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;website&quot;</span>, <span class="string">&quot;_type&quot;</span>: <span class="string">&quot;blog&quot;</span> &#125;&#125;				  </span><br><span class="line">&#123; <span class="string">&quot;title&quot;</span>: <span class="string">&quot;My second blog post&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;update&quot;</span>: &#123; <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;website&quot;</span>, <span class="string">&quot;_type&quot;</span>: <span class="string">&quot;blog&quot;</span>, <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;123&quot;</span>&#125;&#125;</span><br><span class="line">&#123; <span class="string">&quot;doc&quot;</span> : &#123;<span class="string">&quot;title&quot;</span> : <span class="string">&quot;My updated blog post&quot;</span>&#125; &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>bulk API 以此按顺序执行所有的 action（动作） 。 如果一个单个的动作因任何原因而失败，它将继续处理它后面剩余的动作。 当 bulk API 返回时， 它将提供每个动作的状态（与发送的顺序相同） ， 所以您可以检查是否一个指定的动作是不是失败了。</p>
</blockquote>
<h1 id="4进阶检索"><a class="markdownIt-Anchor" href="#4进阶检索"></a> 4.进阶检索</h1>
<h2 id="41导入数据"><a class="markdownIt-Anchor" href="#41导入数据"></a> 4.1导入数据</h2>
<p>数据链接：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://gitee.com/zhourui815/gulimall/blob/master/doc/es%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE.json#</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST bank/account/_bulk</span><br><span class="line">测试数据</span><br></pre></td></tr></table></figure>
<h2 id="42searchapi"><a class="markdownIt-Anchor" href="#42searchapi"></a> 4.2SearchAPI</h2>
<p>ES 支持两种基本方式检索 :</p>
<ul>
<li>一个是通过使用 REST request URI 发送搜索参数（uri+检索参数）</li>
<li>另一个是通过使用 REST request body 来发送它们（uri+请求体</li>
</ul>
<h3 id="421检索信息"><a class="markdownIt-Anchor" href="#421检索信息"></a> 4.2.1检索信息</h3>
<p>**一切检索从_search 开始 **</p>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231125224553112.png" alt="image-20231125224553112" /></p>
<h3 id="422请求参数方式检索"><a class="markdownIt-Anchor" href="#422请求参数方式检索"></a> 4.2.2请求参数方式检索</h3>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#请求参数方式检索</span></span><br><span class="line"><span class="string">q=*</span>  <span class="string">代表要查询的字段类似于select</span> <span class="string">*</span></span><br><span class="line"><span class="string">sort=account_number:asc</span>  <span class="string">代表按照account_number字段排序,升序</span></span><br><span class="line"><span class="string">GET</span> <span class="string">bank/_search?q=*&amp;sort=account_number:asc</span></span><br></pre></td></tr></table></figure>
<h3 id="423uri请求体进行检索"><a class="markdownIt-Anchor" href="#423uri请求体进行检索"></a> 4.2.3uri+请求体进行检索</h3>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#uri+请求体进行检索  </span></span><br><span class="line"><span class="string">GET</span> <span class="string">bank/_search</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;match_all&quot;:</span> &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;sort&quot;:</span> [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;account_number&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;order&quot;:</span> <span class="string">&quot;desc&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="43query-dsl"><a class="markdownIt-Anchor" href="#43query-dsl"></a> 4.3Query DSL</h2>
<p>url+请求体</p>
<p>Elasticsearch 提供了一个可以执行查询的 Json 风格的 DSL（ domain-specific language 领域特定语言） 。 这个被称为 Query DSL。 该查询语言非常全面， 并且刚开始的时候感觉有点复杂，真正学好它的方法是从一些基础的示例开始的。</p>
<h3 id="431语法格式"><a class="markdownIt-Anchor" href="#431语法格式"></a> 4.3.1语法格式</h3>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一个查询语句 的典型结构</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="attr">QUERY_NAME:</span> &#123;</span><br><span class="line">	<span class="attr">ARGUMENT:</span> <span class="string">VALUE</span>,</span><br><span class="line">	<span class="attr">ARGUMENT:</span> <span class="string">VALUE</span>,<span class="string">...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 如果是针对某个字段， 那么它的结构如下：</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="attr">QUERY_NAME:</span> &#123;</span><br><span class="line">		<span class="attr">FIELD_NAME:</span> &#123;</span><br><span class="line">		<span class="attr">ARGUMENT:</span> <span class="string">VALUE</span>,</span><br><span class="line">		<span class="attr">ARGUMENT:</span> <span class="string">VALUE</span>,<span class="string">...</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="432查询示例"><a class="markdownIt-Anchor" href="#432查询示例"></a> 4.3.2查询示例</h3>
<blockquote>
<p>查询bank索引并按照account_number字段降序排序,分页大小为5</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#基本查询示例</span></span><br><span class="line"><span class="string">GET</span> <span class="string">bank/_search</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;match_all&quot;:</span> &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;from&quot;:</span> <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;size&quot;:</span> <span class="number">5</span>,</span><br><span class="line">  <span class="attr">&quot;sort&quot;:</span> [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;account_number&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;order&quot;:</span> <span class="string">&quot;desc&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>query 定义如何查询，</li>
<li>match_all 查询类型【代表查询所有的所有】 ，</li>
<li>es 中可以在 query 中组合非常多的查 询类型完成复杂查询</li>
<li>除了 query 参数之外， 我们也可以传递其它的参数以改变查询结果。 如 sort， size</li>
<li>from+size 限定， 完成分页功能</li>
<li>sort 排序， 多字段排序， 会在前序字段相等时后续字段内部排序， 否则以前序为准</li>
</ul>
</blockquote>
<h3 id="433match匹配"><a class="markdownIt-Anchor" href="#433match匹配"></a> 4.3.3match匹配</h3>
<blockquote>
<p>match 返回 account_number=20 的</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#match 基本类型(非字符串类型),精确匹配  </span></span><br><span class="line"><span class="string">GET</span> <span class="string">bank/_search</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;account_number&quot;:</span> <span class="string">&quot;20&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>最终查询出 address 中包含 mill 单词的所有记录 match 当搜索字符串类型的时候， 会进行全文检索， 并且每条记录有相关性得分。</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#match 字符串类型,全文检索，模糊匹配</span></span><br><span class="line"><span class="string">GET</span> <span class="string">bank/_search</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;address&quot;:</span> <span class="string">&quot;mill&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>最终查询出 address 中包含 mill 或者 road 或者 mill road 的所有记录， 并给出相关性得分</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#match 字符串， 多个单词（ 分词+全文检索）</span></span><br><span class="line"><span class="string">GET</span> <span class="string">bank/_search</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;address&quot;:</span> <span class="string">&quot;mill road&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="434match_phrase短语匹配"><a class="markdownIt-Anchor" href="#434match_phrase短语匹配"></a> 4.3.4match_phrase短语匹配</h3>
<blockquote>
<p>短语匹配：将需要匹配的值当成一个整体单词（ 不分词） 进行检索</p>
<p>查出 address 中包含 mill road 的所有记录， 并给出相关性得分</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#match_phrase 短语匹配</span></span><br><span class="line"><span class="string">GET</span> <span class="string">bank/_search</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;match_phrase&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;address&quot;:</span> <span class="string">&quot;mill road&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="435multi_match-多字段匹配"><a class="markdownIt-Anchor" href="#435multi_match-多字段匹配"></a> 4.3.5multi_match 多字段匹配</h3>
<blockquote>
<p>查询 state 或者 address字段 包含 mill</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#multi_match 多字段匹配</span></span><br><span class="line"><span class="string">GET</span> <span class="string">bank/_search</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;multi_match&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;query&quot;:</span> <span class="string">&quot;mill&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;fields&quot;:</span> [<span class="string">&quot;address&quot;</span>,<span class="string">&quot;state&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="436bool复合查询"><a class="markdownIt-Anchor" href="#436bool复合查询"></a> 4.3.6bool复合查询</h3>
<blockquote>
<p>bool 用来做复合查询：<br />
复合语句可以合并 任何 其它查询语句， 包括复合语句，  复合语句之间可以互相嵌套， 可以表达非常复杂的逻辑。</p>
</blockquote>
<h4 id="1must"><a class="markdownIt-Anchor" href="#1must"></a> （1）must</h4>
<blockquote>
<p>必须达到 must 列举的所有条件</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># must 必须达到 must 列举的所有条件</span></span><br><span class="line"><span class="string">GET</span> <span class="string">bank/_search</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;bool&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;must&quot;:</span> [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;match&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;address&quot;:</span> <span class="string">&quot;Mill&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;match&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;gender&quot;:</span> <span class="string">&quot;M&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2should"><a class="markdownIt-Anchor" href="#2should"></a> （2）should</h4>
<blockquote>
<p>应该达到 should 列举的条件， 如果达到会增加相关文档的评分， 并不会改变查询的结果。</p>
<p>如果 query 中只有 should 且只有一种匹配规则， 那么 should 的条件就会被作为默认匹配条件而去改变查询结果</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 应该达到 should列举的条件，如果达到会增加相关文档的评分，并不会改变查询的结果。</span></span><br><span class="line"><span class="string">GET</span> <span class="string">bank/_search</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;bool&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;must&quot;:</span> [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;match&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;address&quot;:</span> <span class="string">&quot;mill&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;match&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;gender&quot;:</span> <span class="string">&quot;M&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;should&quot;:</span> [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;match&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;address&quot;:</span> <span class="string">&quot;lane&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3must_not"><a class="markdownIt-Anchor" href="#3must_not"></a> （3）must_not</h4>
<blockquote>
<p>必须不是指定的情况</p>
<p>address 包含 mill， 并且 gender 是 M， 如果 address 里面有 lane 最好不过， 但是匹配的字段必须不是文本类型</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#must_not 必须不是指定的情况  </span></span><br><span class="line"><span class="string">GET</span> <span class="string">bank/_search</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;bool&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;must&quot;:</span> [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;match&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;address&quot;:</span> <span class="string">&quot;mill&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;match&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;gender&quot;:</span> <span class="string">&quot;M&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;should&quot;:</span> [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;match&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;address&quot;:</span> <span class="string">&quot;lane&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;must_not&quot;:</span> [</span><br><span class="line">        &#123;<span class="attr">&quot;match&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;FIELD&quot;:</span> <span class="string">&quot;TEXT&quot;</span></span><br><span class="line">        &#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4filter结果过滤"><a class="markdownIt-Anchor" href="#4filter结果过滤"></a> （4）filter结果过滤</h4>
<blockquote>
<p>并不是所有的查询都需要产生分数， 特别是那些仅用于 “filtering”（过滤） 的文档。 **为了不计算分数 **Elasticsearch 会自动检查场景并且优化查询的执行。</p>
</blockquote>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231125233601072.png" alt="image-20231125233601072" /></p>
<h4 id="5小结"><a class="markdownIt-Anchor" href="#5小结"></a> （5）小结</h4>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231125233651828.png" alt="image-20231125233651828" /></p>
<h3 id="437term非text字段检索"><a class="markdownIt-Anchor" href="#437term非text字段检索"></a> 4.3.7term—非text字段检索</h3>
<blockquote>
<p>和 match 一样。 匹配某个属性的值。 全文检索字段用 match， 其他<strong>非 text 字段</strong>匹配用 term。</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#term 其他非 text 字段检索</span></span><br><span class="line"><span class="string">GET</span> <span class="string">bank/_search</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;bool&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;must&quot;:</span> [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;term&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;account_number&quot;:</span> &#123;</span><br><span class="line">              <span class="attr">&quot;value&quot;:</span> <span class="string">&quot;970&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;match&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;address&quot;:</span> <span class="string">&quot;Mill&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="438aggregations聚合检索"><a class="markdownIt-Anchor" href="#438aggregations聚合检索"></a> 4.3.8aggregations聚合检索</h3>
<ol>
<li>最简单的聚合方法大致等于 SQL GROUP BY 和 SQL 聚合函数。</li>
<li>在 Elasticsearch 中， 您有执行搜索返回 hits（ 命中结果），并且同时返回聚合结果， 把一个响应中的所有 hits（ 命中结果） 分隔开的能力。</li>
<li>可以执行查询和多个聚合， 并且在一次使用中得到各自的（ 任何一个的） 返回结果， 使用一次简洁和简化的 API 来避免网络往返。</li>
</ol>
<blockquote>
<p>写在前面：有很多种聚合方式：terms、avgs聚合</p>
</blockquote>
<img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126091812312.png" alt="image-20231126091812312" style="zoom:50%;" />
<h4 id="1年龄分布-并求出年龄的平均值"><a class="markdownIt-Anchor" href="#1年龄分布-并求出年龄的平均值"></a> （1）年龄分布、并求出年龄的平均值</h4>
<blockquote>
<p>搜索 address 中包含 mill 的所有人的年龄分布以及平均年龄， 但不显示这些人的详情（size=0）</p>
</blockquote>
<img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126092304394.png" alt="image-20231126092304394" style="zoom: 50%;" />
<h4 id="2求出年龄分布并在每个年龄求平均薪资"><a class="markdownIt-Anchor" href="#2求出年龄分布并在每个年龄求平均薪资"></a> （2）求出年龄分布,并在每个年龄求平均薪资</h4>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126092648463.png" alt="image-20231126092648463" /></p>
<h2 id="44mapping"><a class="markdownIt-Anchor" href="#44mapping"></a> 4.4Mapping</h2>
<h3 id="441字段类型"><a class="markdownIt-Anchor" href="#441字段类型"></a> 4.4.1字段类型</h3>
<ol>
<li>字段类型有核心类型、复合类型、地理类型、特定类型以及多字段类型共5种</li>
<li><strong>核心类型：</strong>
<ol>
<li>字符串：string、text、keyword</li>
<li>数字类型：long、integer、short、byte、double、float</li>
<li>日期类型：date</li>
<li>布尔类型：boolean</li>
<li>二进制类型：binary</li>
</ol>
</li>
<li>**复合类型：**数组类型（Array）、对象类型（Object）、嵌套类型（Nested）</li>
<li>**地理类型：**地理坐标（Geo-points）、地理图形（Geo-Shape）</li>
<li>**特定类型：**IP类型（ip）、补全类型（Completion）、令牌计数类型（Token count）、附件类型（attachment）</li>
<li>**多字段类型：**通常用于为不同目的用不同的方法索I同一个字段。例如，<strong>string字段</strong>可以映射为一个text字段用于全文检索，同样可以映射为一个keyword字段用于排序和聚合</li>
</ol>
<h3 id="442映射简介"><a class="markdownIt-Anchor" href="#442映射简介"></a> 4.4.2映射简介</h3>
<ol>
<li>定义：Mapping 是用来定义一个文档（ document） ， 以及它所包含的属性（ field） 是如何存储和索引的。 比如， 使用 mapping 来定义：
<ol>
<li>哪些字符串属性应该被看做全文本属性（full text fields）</li>
<li>哪些属性包含数字， 日期或者地理位置。</li>
<li>文档中的所有属性是否都能被索引</li>
</ol>
</li>
</ol>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看mapping信息</span></span><br><span class="line"><span class="string">GET</span> <span class="string">bank/_mapping</span></span><br></pre></td></tr></table></figure>
<img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126093413138.png" alt="image-20231126093413138" style="zoom:50%;" />
<ul>
<li>问题：我们在创建索引是没有指定类型，为什么会查询出来呢?</li>
<li>答案：es会根据数据自动猜测的映射类型，自动猜测的映射类型有：
<ul>
<li>布尔型：true或者false，猜测的映射类型为boolean</li>
<li>整数：123，猜测的映射类型为long</li>
<li>浮点数：123.45，猜测的映射类型为double</li>
<li>字符串，有效日期：2024-10-10，猜测的映射类型为date</li>
<li>字符串：foo bar，猜测的映射类型为string</li>
</ul>
</li>
</ul>
<h3 id="443创建映射"><a class="markdownIt-Anchor" href="#443创建映射"></a> 4.4.3创建映射</h3>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126094141793.png" alt="image-20231126094141793" /></p>
<h3 id="444更新映射"><a class="markdownIt-Anchor" href="#444更新映射"></a> 4.4.4更新映射</h3>
<p>对于已经存在的映射字段， 我们不能更新。 更新必须创建新的索引进行数据迁移</p>
<h3 id="445数据迁移"><a class="markdownIt-Anchor" href="#445数据迁移"></a> 4.4.5数据迁移</h3>
<h4 id="1查询之前的映射"><a class="markdownIt-Anchor" href="#1查询之前的映射"></a> （1）查询之前的映射</h4>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">GET</span> <span class="string">bank/_mapping</span></span><br></pre></td></tr></table></figure>
<ul>
<li>将查询的字段映射复制出来</li>
<li>假设age字段类型为long，想换成integer类型</li>
</ul>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126100102484.png" alt="image-20231126100102484" /></p>
<h4 id="2新增一个新索引"><a class="markdownIt-Anchor" href="#2新增一个新索引"></a> （2）新增一个新索引</h4>
<p>将复制的属性粘贴到属性中，先不执行</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;account_number&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;address&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;keyword&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ignore_above&quot;</span> <span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;age&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;balance&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;city&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;keyword&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ignore_above&quot;</span> <span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;email&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;keyword&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ignore_above&quot;</span> <span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;employer&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;keyword&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ignore_above&quot;</span> <span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;firstname&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;keyword&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ignore_above&quot;</span> <span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;gender&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;keyword&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ignore_above&quot;</span> <span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;lastname&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;keyword&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ignore_above&quot;</span> <span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;state&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;keyword&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ignore_above&quot;</span> <span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="3修改映射"><a class="markdownIt-Anchor" href="#3修改映射"></a> （3）修改映射</h4>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个新索引</span></span><br><span class="line"><span class="string">PUT</span> <span class="string">newbank2</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;mappings&quot;</span><span class="string">:</span>&#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;account_number&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;address&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;age&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;balance&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;city&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;text&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;fields&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;keyword&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;ignore_above&quot;:</span> <span class="number">256</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;email&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;text&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;fields&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;keyword&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;ignore_above&quot;:</span> <span class="number">256</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;employer&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;text&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;fields&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;keyword&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;ignore_above&quot;:</span> <span class="number">256</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;firstname&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;text&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;fields&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;keyword&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;ignore_above&quot;:</span> <span class="number">256</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;gender&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;text&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;fields&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;keyword&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;ignore_above&quot;:</span> <span class="number">256</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;lastname&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;text&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;fields&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;keyword&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;ignore_above&quot;:</span> <span class="number">256</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;state&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;text&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;fields&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;keyword&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;ignore_above&quot;:</span> <span class="number">256</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4数据迁移"><a class="markdownIt-Anchor" href="#4数据迁移"></a> （4）数据迁移</h4>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#数据迁移</span></span><br><span class="line"><span class="string">POST</span> <span class="string">_reindex</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;:</span> <span class="string">&quot;bank&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;:</span> <span class="string">&quot;newbank2&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>迁移成功</p>
</blockquote>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126101222331.png" alt="image-20231126101222331" /></p>
<h2 id="45分词待重写"><a class="markdownIt-Anchor" href="#45分词待重写"></a> <mark>4.5分词（待重写）</mark></h2>
<ol>
<li>
<p>在ES中，一个 tokenizer（ 分词器） 接收一个字符流， 将之分割为独立的 tokens（ 词元， 通常是独立的单词） ， 然后输出 tokens 流。</p>
<ol>
<li>例如， whitespace tokenizer 遇到空白字符时分割文本。 它会将文本 “Quick brown fox!” 分割为 [Quick, brown, fox!]。</li>
<li>该 tokenizer（分词器） 还负责记录各个 term（词条） 的顺序或 position 位置（用于 phrase 短语和 word proximity 词近邻查询） ， 以及 term（词条） 所代表的原始 word（单词） 的 start（起始） 和 end（结束） 的 character offsets（字符偏移量） （用于高亮显示搜索的内容） 。</li>
</ol>
</li>
<li>
<p>Elasticsearch 提供了很多内置的分词器， 可以用来构建 custom analyzers（自定义分词器） 。</p>
</li>
</ol>
<h3 id="451安装ik分词器"><a class="markdownIt-Anchor" href="#451安装ik分词器"></a> 4.5.1安装ik分词器</h3>
<p>没有安装分词器之前的效果</p>
<img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126102404692.png" alt="image-20231126102404692" style="zoom:50%;" />
<p>**注意： 不能用默认 elasticsearch-plugin install xxx.zip 进行自动安装 **</p>
<blockquote>
<p>由于之前映射了plugins目录,所以在/mydata/elasticsearch/plugins/下载elasticsearch-analysis-ik-7.4.2.zip</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.4.2/elasticsearch-analysis-ik-7.4.2.zip</span><br></pre></td></tr></table></figure>
<blockquote>
<p>解压</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip elasticsearch-analysis-ik-7.4.2.zip</span><br></pre></td></tr></table></figure>
<blockquote>
<p>删除zip文件</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm –rf *.zip</span><br></pre></td></tr></table></figure>
<blockquote>
<p>将elasticsearch文件夹下的所有文件 移动至ik目录下(自建目录)</p>
</blockquote>
<p><mark><strong>使用xftp进行移动</strong></mark></p>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126110523062.png" alt="image-20231126110523062" /></p>
<blockquote>
<p>修改ik文件夹权限</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">chmod</span> <span class="string">-R</span> <span class="number">777</span> <span class="string">ik</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>确认是否安装好了分词器</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#进入容器内部</span></span><br><span class="line"><span class="string">docker</span> <span class="string">exec</span> <span class="string">-it</span> <span class="string">容器</span> <span class="string">id</span> <span class="string">/bin/bash</span></span><br><span class="line"><span class="comment">#切换目录</span></span><br><span class="line"><span class="string">cd</span> <span class="string">bin</span></span><br><span class="line"><span class="comment">#列出安装的plugin</span></span><br><span class="line"><span class="string">elasticsearch</span> <span class="string">plugin</span> <span class="string">list</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>发现ik后重启容器</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">docker</span> <span class="string">restart</span> <span class="string">elasticsearch</span></span><br></pre></td></tr></table></figure>
<h3 id="452测试分词器"><a class="markdownIt-Anchor" href="#452测试分词器"></a> 4.5.2测试分词器</h3>
<h4 id="1使用默认分词器"><a class="markdownIt-Anchor" href="#1使用默认分词器"></a> （1）使用默认分词器</h4>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126110748326.png" alt="image-20231126110748326" /></p>
<h4 id="2使用ik_smart分词器"><a class="markdownIt-Anchor" href="#2使用ik_smart分词器"></a> （2）使用ik_smart分词器</h4>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126110816338.png" alt="image-20231126110816338" /></p>
<h4 id="3使用ik_max_word-分词器"><a class="markdownIt-Anchor" href="#3使用ik_max_word-分词器"></a> （3）使用ik_max_word 分词器</h4>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126110900124.png" alt="image-20231126110900124" /></p>
<h4 id="4总结"><a class="markdownIt-Anchor" href="#4总结"></a> （4）总结</h4>
<p>能够看出不同的分词器， 分词有明显的区别， 所以以后定义一个索引不能再使用默认的 mapping 了， 要手工建立 mapping, 因为要选择分词器。</p>
<h3 id="453自定义词库"><a class="markdownIt-Anchor" href="#453自定义词库"></a> 4.5.3自定义词库</h3>
<h3 id="454未自定义词库"><a class="markdownIt-Anchor" href="#454未自定义词库"></a> 4.5.4未自定义词库</h3>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126111345748.png" alt="image-20231126111345748" /></p>
<p>自定义词库测试</p>
<ul>
<li>创建词库</li>
</ul>
<blockquote>
<p><strong>在4.6：搭建好nginx的基础上,搭建nginx在8.x章节</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /mydata/nginx/html/</span><br><span class="line">#创建自定义词库</span><br><span class="line">vim fenci.txt</span><br></pre></td></tr></table></figure>
<p>添加新词</p>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126114652319.png" alt="image-20231126114652319" /></p>
<ul>
<li>修改分词器配置文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /mydata/elasticsearch/plugins/ik/config/IKAnalyzer.cfg.xml</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126120129228.png" alt="image-20231126120129228" /></p>
<ul>
<li>重启es</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart elasticsearch</span><br></pre></td></tr></table></figure>
<ul>
<li>效果</li>
</ul>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126120246793.png" alt="image-20231126120246793" /></p>
<h1 id="5springboot整合es"><a class="markdownIt-Anchor" href="#5springboot整合es"></a> 5.SpringBoot整合ES</h1>
<h2 id="51xml配置"><a class="markdownIt-Anchor" href="#51xml配置"></a> 5.1xml配置</h2>
<p>SpringBoot想和ES进行通信传递消息的方式有两种：tcp、http</p>
<ol>
<li>
<p>9300： TCP</p>
<ol>
<li>需要的jar包：spring-data-elasticsearch:transport-api.jar；</li>
<li>springboot 版本不同， transport-api.jar 不同， 不能适配 es 版本</li>
<li>7.x 已经不建议使用， 8 以后就要废弃</li>
</ol>
</li>
<li>
<p>9200： HTTP，有以下四种通信方式</p>
<ol>
<li>JestClient： 非官方， 更新慢</li>
<li>RestTemplate： 模拟发 HTTP 请求， ES 很多操作需要自己封装， 麻烦</li>
<li>HttpClient： 同上</li>
<li>Elasticsearch-Rest-Client： 官方 RestClient， 封装了 ES 操作， API 层次分明， 上手简单</li>
</ol>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">可能出现bug，换成以下依赖</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="52配置类"><a class="markdownIt-Anchor" href="#52配置类"></a> 5.2配置类</h2>
<p>主启动类添加注解：@EnableDiscoverClient</p>
<img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126171800066.png" alt="image-20231126171800066" style="zoom: 67%;" />
<p>添加：配置类</p>
<img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126171821397.png" alt="image-20231126171821397" style="zoom: 50%;" />
<h2 id="53测试连接"><a class="markdownIt-Anchor" href="#53测试连接"></a> 5.3测试连接</h2>
<img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126171840588.png" alt="image-20231126171840588" style="zoom: 50%;" />
<p>测试结果：</p>
<img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126171738371.png" alt="image-20231126171738371" style="zoom: 50%;" />
<h2 id="54测试使用"><a class="markdownIt-Anchor" href="#54测试使用"></a> 5.4测试使用</h2>
<h3 id="541索引新增记录"><a class="markdownIt-Anchor" href="#541索引新增记录"></a> 5.4.1索引(新增)记录</h3>
<img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126223459965.png" alt="image-20231126223459965" style="zoom: 50%;" />
<ul>
<li>测试结果</li>
</ul>
<img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126181349680.png" alt="image-20231126181349680" style="zoom: 50%;" />
<h3 id="542获取数据"><a class="markdownIt-Anchor" href="#542获取数据"></a> 5.4.2获取数据</h3>
<img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126223642236.png" alt="image-20231126223642236" style="zoom: 50%;" />
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#match 字符串类型全文检索</span></span><br><span class="line"><span class="string">GET</span> <span class="string">bank/_search</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;address&quot;:</span> <span class="string">&quot;mill&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>两个查询结果相同</p>
</blockquote>
<h3 id="543聚合查询"><a class="markdownIt-Anchor" href="#543聚合查询"></a> 5.4.3聚合查询</h3>
<img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126224123565.png" alt="image-20231126224123565" style="zoom:50%;" />
<img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126224024399.png" alt="image-20231126224024399" style="zoom:50%;" />
<h3 id="544结果转为对象"><a class="markdownIt-Anchor" href="#544结果转为对象"></a> 5.4.4结果转为对象</h3>
<blockquote>
<p>具体结果在下面那个hits里</p>
</blockquote>
<img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126224247804.png" alt="image-20231126224247804" style="zoom:50%;" />
<blockquote>
<p>利用json生成javabean,并使用lombok</p>
</blockquote>
<img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126224421195.png" alt="image-20231126224421195" style="zoom:50%;" />
<ul>
<li>测试</li>
</ul>
<img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126224706454.png" alt="image-20231126224706454" style="zoom: 67%;" />
<ul>
<li>结果</li>
</ul>
<p><img src="https://gitee.com/linhaipengg/md_-picture/raw/master/image-20231126224630489.png" alt="image-20231126224630489" /></p>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>ElasticSearch学习笔记</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://www.haipeng-lin.cn/posts/172c1a2d.html">https://www.haipeng-lin.cn/posts/172c1a2d.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a" style="display: inline-block;width: 120px"><h>作者</h><div class="post-copyright-cc-info"><h>拾忆鱼</h></div></div><div class="post-copyright-c" style="display: inline-block;width: 120px"><h>发布于</h><div class="post-copyright-cc-info"><h>2024-10-16</h></div></div><div class="post-copyright-u" style="display: inline-block;width: 120px"><h>更新于</h><div class="post-copyright-cc-info"><h>2024-10-16</h></div></div><div class="post-copyright-c" style="display: inline-block;width: 120px"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY 4.0" href="https://creativecommons.org/licenses/by/4.0/deed.zh">CC BY 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringBoot/">SpringBoot</a></div><div class="post_share"><div class="social-share" data-image="https://haipeng-lin.oss-cn-shenzhen.aliyuncs.com/202410161138400.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://lib.baomitu.com/social-share.js/1.0.16/css/share.min.css" media="print" onload="this.media='all'"><script src="https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/8239deef.html"><img class="prev-cover" src="https://haipeng-lin.oss-cn-shenzhen.aliyuncs.com/202410282106730.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">基于微信公众号+验证码实现微信登录</div></div></a></div><div class="next-post pull-right"><a href="/posts/6982816f.html"><img class="next-cover" src="https://haipeng-lin.oss-cn-shenzhen.aliyuncs.com/202410131719724.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">RocketMQ学习笔记</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/4ebad2d4.html" title="SpringBoot整合Redis"><img class="cover" src="https://i-blog.csdnimg.cn/blog_migrate/fc6ebdd5464d6c592f3363bc942cf14f.jpeg#pic_center" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-30</div><div class="title">SpringBoot整合Redis</div></div></a></div><div><a href="/posts/18bf100b.html" title="SpringBoot基础篇"><img class="cover" src="https://i-blog.csdnimg.cn/blog_migrate/2b37069e05120f2696d7a1cb32152359.jpeg#pic_center" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-28</div><div class="title">SpringBoot基础篇</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://haipeng-lin.oss-cn-shenzhen.aliyuncs.com/202410101530409.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">拾忆鱼</div><div class="author-info__description">一条菜鱼的小破站</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">59</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">小菜鱼正在从CSDN博客搬家，尽请期待　　      地址：<a target="_blank" rel="noopener" href="https://haipeng-lin.blog.csdn.net/">haipeng-lin.blog.csdn.net</a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1elasticsearch%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text"> 1.ElasticSearch是什么</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11elasticsearch%E7%AE%80%E4%BB%8B"><span class="toc-text"> 1.1ElasticSearch简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12es%E4%B8%8Esolr%E5%AF%B9%E6%AF%94"><span class="toc-text"> 1.2ES与Solr对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13es%E4%B8%8Emysql%E5%AF%B9%E6%AF%94"><span class="toc-text"> 1.3ES与MySQL对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14es%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-text"> 1.4ES基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#141index-%E7%B4%A2%E5%BC%95"><span class="toc-text"> 1.4.1Index-索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#142type-%E7%B1%BB%E5%9E%8B"><span class="toc-text"> 1.4.2Type-类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#143document-%E6%96%87%E6%A1%A3"><span class="toc-text"> 1.4.3Document-文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#144%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95"><span class="toc-text"> 1.4.4倒排索引</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2%E5%AE%89%E8%A3%85elasticsearch"><span class="toc-text"> 2.安装ElasticSearch</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#21%E5%9F%BA%E4%BA%8Edocker%E5%AE%89%E8%A3%85es%E4%B8%8Ekibana"><span class="toc-text"> 2.1基于Docker安装ES与Kibana</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#211%E4%B8%8B%E8%BD%BD%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6"><span class="toc-text"> 2.1.1下载镜像文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#212%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BE%8B"><span class="toc-text"> 2.1.2创建实例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E5%88%9B%E5%BB%BAelasticsearch%E5%AE%9E%E4%BE%8B"><span class="toc-text"> （1）创建ElasticSearch实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E5%88%9B%E5%BB%BAkibana%E5%AE%9E%E4%BE%8B"><span class="toc-text"> （2）创建Kibana实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#213%E8%AE%BE%E7%BD%AEes%E5%92%8Ckibana%E8%87%AA%E5%90%AF%E5%8A%A8"><span class="toc-text"> 2.1.3设置es和kibana自启动</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22%E5%9F%BA%E4%BA%8Ewindows%E5%AE%89%E8%A3%85es%E4%B8%8Ekibana"><span class="toc-text"> 2.2基于Windows安装ES与Kibana</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3%E5%88%9D%E7%BA%A7%E6%A3%80%E7%B4%A2"><span class="toc-text"> 3.初级检索</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#31%E6%9F%A5%E7%9C%8B%E8%8A%82%E7%82%B9%E7%B4%A2%E5%BC%95"><span class="toc-text"> 3.1查看节点&#x2F;索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#32%E7%B4%A2%E5%BC%95%E4%BF%9D%E5%AD%98%E6%96%87%E6%A1%A3"><span class="toc-text"> 3.2索引（保存）文档</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#321put%E6%96%B9%E6%B3%95"><span class="toc-text"> 3.2.1PUT方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#322post%E6%96%B9%E6%B3%95"><span class="toc-text"> 3.2.2POST方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#323put%E5%92%8Cpost%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text"> 3.2.3PUT和POST的区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#33%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9Aid%E6%96%87%E6%A1%A3"><span class="toc-text"> 3.3查询指定id文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#34%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3"><span class="toc-text"> 3.4更新文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#35%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-text"> 3.5删除索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#36bulk%E6%89%B9%E9%87%8Fapi"><span class="toc-text"> 3.6bulk批量API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#361%E8%AF%AD%E6%B3%95%E6%A0%BC%E5%BC%8F"><span class="toc-text"> 3.6.1语法格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#362%E5%A4%8D%E6%9D%82bulk"><span class="toc-text"> 3.6.2复杂bulk</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4%E8%BF%9B%E9%98%B6%E6%A3%80%E7%B4%A2"><span class="toc-text"> 4.进阶检索</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#41%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-text"> 4.1导入数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#42searchapi"><span class="toc-text"> 4.2SearchAPI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#421%E6%A3%80%E7%B4%A2%E4%BF%A1%E6%81%AF"><span class="toc-text"> 4.2.1检索信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#422%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%96%B9%E5%BC%8F%E6%A3%80%E7%B4%A2"><span class="toc-text"> 4.2.2请求参数方式检索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#423uri%E8%AF%B7%E6%B1%82%E4%BD%93%E8%BF%9B%E8%A1%8C%E6%A3%80%E7%B4%A2"><span class="toc-text"> 4.2.3uri+请求体进行检索</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#43query-dsl"><span class="toc-text"> 4.3Query DSL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#431%E8%AF%AD%E6%B3%95%E6%A0%BC%E5%BC%8F"><span class="toc-text"> 4.3.1语法格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#432%E6%9F%A5%E8%AF%A2%E7%A4%BA%E4%BE%8B"><span class="toc-text"> 4.3.2查询示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#433match%E5%8C%B9%E9%85%8D"><span class="toc-text"> 4.3.3match匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#434match_phrase%E7%9F%AD%E8%AF%AD%E5%8C%B9%E9%85%8D"><span class="toc-text"> 4.3.4match_phrase短语匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#435multi_match-%E5%A4%9A%E5%AD%97%E6%AE%B5%E5%8C%B9%E9%85%8D"><span class="toc-text"> 4.3.5multi_match 多字段匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#436bool%E5%A4%8D%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-text"> 4.3.6bool复合查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1must"><span class="toc-text"> （1）must</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2should"><span class="toc-text"> （2）should</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3must_not"><span class="toc-text"> （3）must_not</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4filter%E7%BB%93%E6%9E%9C%E8%BF%87%E6%BB%A4"><span class="toc-text"> （4）filter结果过滤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E5%B0%8F%E7%BB%93"><span class="toc-text"> （5）小结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#437term%E9%9D%9Etext%E5%AD%97%E6%AE%B5%E6%A3%80%E7%B4%A2"><span class="toc-text"> 4.3.7term—非text字段检索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#438aggregations%E8%81%9A%E5%90%88%E6%A3%80%E7%B4%A2"><span class="toc-text"> 4.3.8aggregations聚合检索</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E5%B9%B4%E9%BE%84%E5%88%86%E5%B8%83-%E5%B9%B6%E6%B1%82%E5%87%BA%E5%B9%B4%E9%BE%84%E7%9A%84%E5%B9%B3%E5%9D%87%E5%80%BC"><span class="toc-text"> （1）年龄分布、并求出年龄的平均值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E6%B1%82%E5%87%BA%E5%B9%B4%E9%BE%84%E5%88%86%E5%B8%83%E5%B9%B6%E5%9C%A8%E6%AF%8F%E4%B8%AA%E5%B9%B4%E9%BE%84%E6%B1%82%E5%B9%B3%E5%9D%87%E8%96%AA%E8%B5%84"><span class="toc-text"> （2）求出年龄分布,并在每个年龄求平均薪资</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#44mapping"><span class="toc-text"> 4.4Mapping</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#441%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"><span class="toc-text"> 4.4.1字段类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#442%E6%98%A0%E5%B0%84%E7%AE%80%E4%BB%8B"><span class="toc-text"> 4.4.2映射简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#443%E5%88%9B%E5%BB%BA%E6%98%A0%E5%B0%84"><span class="toc-text"> 4.4.3创建映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#444%E6%9B%B4%E6%96%B0%E6%98%A0%E5%B0%84"><span class="toc-text"> 4.4.4更新映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#445%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB"><span class="toc-text"> 4.4.5数据迁移</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E6%9F%A5%E8%AF%A2%E4%B9%8B%E5%89%8D%E7%9A%84%E6%98%A0%E5%B0%84"><span class="toc-text"> （1）查询之前的映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E6%96%B0%E5%A2%9E%E4%B8%80%E4%B8%AA%E6%96%B0%E7%B4%A2%E5%BC%95"><span class="toc-text"> （2）新增一个新索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E4%BF%AE%E6%94%B9%E6%98%A0%E5%B0%84"><span class="toc-text"> （3）修改映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB"><span class="toc-text"> （4）数据迁移</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#45%E5%88%86%E8%AF%8D%E5%BE%85%E9%87%8D%E5%86%99"><span class="toc-text"> 4.5分词（待重写）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#451%E5%AE%89%E8%A3%85ik%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-text"> 4.5.1安装ik分词器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#452%E6%B5%8B%E8%AF%95%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-text"> 4.5.2测试分词器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E4%BD%BF%E7%94%A8%E9%BB%98%E8%AE%A4%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-text"> （1）使用默认分词器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E4%BD%BF%E7%94%A8ik_smart%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-text"> （2）使用ik_smart分词器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E4%BD%BF%E7%94%A8ik_max_word-%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-text"> （3）使用ik_max_word 分词器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E6%80%BB%E7%BB%93"><span class="toc-text"> （4）总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#453%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%8D%E5%BA%93"><span class="toc-text"> 4.5.3自定义词库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#454%E6%9C%AA%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%8D%E5%BA%93"><span class="toc-text"> 4.5.4未自定义词库</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5springboot%E6%95%B4%E5%90%88es"><span class="toc-text"> 5.SpringBoot整合ES</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#51xml%E9%85%8D%E7%BD%AE"><span class="toc-text"> 5.1xml配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#52%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-text"> 5.2配置类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#53%E6%B5%8B%E8%AF%95%E8%BF%9E%E6%8E%A5"><span class="toc-text"> 5.3测试连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#54%E6%B5%8B%E8%AF%95%E4%BD%BF%E7%94%A8"><span class="toc-text"> 5.4测试使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#541%E7%B4%A2%E5%BC%95%E6%96%B0%E5%A2%9E%E8%AE%B0%E5%BD%95"><span class="toc-text"> 5.4.1索引(新增)记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#542%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-text"> 5.4.2获取数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#543%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-text"> 5.4.3聚合查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#544%E7%BB%93%E6%9E%9C%E8%BD%AC%E4%B8%BA%E5%AF%B9%E8%B1%A1"><span class="toc-text"> 5.4.4结果转为对象</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/8239deef.html" title="基于微信公众号+验证码实现微信登录"><img src="https://haipeng-lin.oss-cn-shenzhen.aliyuncs.com/202410282106730.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于微信公众号+验证码实现微信登录"/></a><div class="content"><a class="title" href="/posts/8239deef.html" title="基于微信公众号+验证码实现微信登录">基于微信公众号+验证码实现微信登录</a><time datetime="2024-10-28T13:05:25.000Z" title="发表于 2024-10-28 21:05:25">2024-10-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/172c1a2d.html" title="ElasticSearch学习笔记"><img src="https://haipeng-lin.oss-cn-shenzhen.aliyuncs.com/202410161138400.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ElasticSearch学习笔记"/></a><div class="content"><a class="title" href="/posts/172c1a2d.html" title="ElasticSearch学习笔记">ElasticSearch学习笔记</a><time datetime="2024-10-16T03:36:17.000Z" title="发表于 2024-10-16 11:36:17">2024-10-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/6982816f.html" title="RocketMQ学习笔记"><img src="https://haipeng-lin.oss-cn-shenzhen.aliyuncs.com/202410131719724.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RocketMQ学习笔记"/></a><div class="content"><a class="title" href="/posts/6982816f.html" title="RocketMQ学习笔记">RocketMQ学习笔记</a><time datetime="2024-10-13T09:17:30.000Z" title="发表于 2024-10-13 17:17:30">2024-10-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/d1f540b5.html" title="收集 | 有情怀的网站"><img src="https://haipeng-lin.oss-cn-shenzhen.aliyuncs.com/202410111137749.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="收集 | 有情怀的网站"/></a><div class="content"><a class="title" href="/posts/d1f540b5.html" title="收集 | 有情怀的网站">收集 | 有情怀的网站</a><time datetime="2024-10-10T12:21:25.000Z" title="发表于 2024-10-10 20:21:25">2024-10-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/d0dd6ec8.html" title="为什么HashMap线程不安全"><img src="https://haipeng-lin.oss-cn-shenzhen.aliyuncs.com/202410101225904.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="为什么HashMap线程不安全"/></a><div class="content"><a class="title" href="/posts/d0dd6ec8.html" title="为什么HashMap线程不安全">为什么HashMap线程不安全</a><time datetime="2024-10-10T04:24:58.000Z" title="发表于 2024-10-10 12:24:58">2024-10-10</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer-left"><div class="footer-title"><span>拾忆鱼's Blog | </span><span class="footer-copyright">&copy;2024 By 拾忆鱼</span></div><div class="wordcount"></div><span>拾忆鱼 已经写了 260k 字，</span><span>好像写完一本 钱钟书 的 《围城》 了啊</span></div><div id="footer-right"><div class="footer_custom_text"><div id="runtime"></div></div><div class="footer-totop"><i class="fas fa-chevron-up" onclick="rmf.scrollToTop()"></i></div><div class="footer-info"><p>使用Hexo框架 | 基于butterfly修改 | 萌ICP备20240730号</p><!--a(title='湘公网安备 2023003198号' href='http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=2023003198')= '湘公网安备 2023003198号'--><!--a(title='湘ICP备2023003198号' href='https://beian.miit.gov.cn/')= '湘ICP备2023003198号'--></div><div class="footer-service"><a title="51LA" target="_blank" rel="noopener" href="https://www.51.la"><img alt="51LA" src="https://gitee.com/linhaipengg/md_-picture/raw/master/51la.png"/></a><a title="CC BY-NC-SA 4.0" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><img alt="CC BY-NC-SA 4.0" src="https://img.june-pj.cn/img/2024/01/16/cc.webp"/></a></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.haipeng-lin.cn',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.haipeng-lin.cn',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/twikoo/1.4.18/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script data-pjax src="/gitcalendar/js/gitcalendar.js"></script><script data-pjax src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/js/swiper.min.js"></script><script src="/js/footer.js"></script><script type="text/javascript" src="/js/main.js"></script><script data-pjax type="text/javascript" src="/js/essay/essay.js"></script><script data-pjax type="text/javascript" src="/js/essay/waterfall.js"></script><link rel="stylesheet" href="/css/swiper.css"><script data-pjax src="/js/categoryBar/categoryBar.js"></script><link data-pjax defer="" rel="stylesheet" href="/css/categoryBar/heoMainColor.css"><link data-pjax defer="" rel="stylesheet" href="/css/categoryBar/categoryBar.css"><script type="text/javascript" src="/js/nav.js"></script><script src="/js/countup.js"></script><script data-pjax type="text/javascript" src="/js/memos/waterfall.min.js"></script><script data-pjax type="text/javascript" src="/js/memos/imgStatus.min.js"></script><script data-pjax type="text/javascript" src="/js/memos/lately.min.js"></script><script type="text/javascript" src="/js/memos/photo.js"></script><script type="text/javascript" src="/js/icat.js"></script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn1.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>